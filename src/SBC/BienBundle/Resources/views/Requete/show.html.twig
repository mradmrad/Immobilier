{% extends "::layout.html.twig" %}
{% block title %}
    Lecture d'un requête - {{ parent() }}
{% endblock %}
{% block body %}
    <div id="page_heading" data-uk-sticky="{ top: 48, media: 960 }">
        {#<ul id="breadcrumbs" style="float: right;">#}
        {#<li><a href="#">Requêtes</a></li>#}
        {#<li><span>Afficher une requête({{ requete.reference }})</span></li>#}
        {#</ul>#}

        {#<span class="uk-text-muted uk-text-upper uk-text-small">{{ requete.creationDate|date('d/m/Y') }}</span>#}

        <div>
            <i class="material-icons">perm_identity</i>
            Client : {{ requete.client.denomination }}<br>
            <i class="material-icons">phone_cell</i>
            Tél : {{ requete.client.tel }}

        </div>
        <div class="uk-text-right" style="margin-top: -40px">
            <h1>{{ requete.reference }}</h1>
        </div>
        <div class="uk-text-right">
            <i class="material-icons">&#xE916;</i>
            Date insertion :
            {{ requete.creationDate|date('d-m-Y') }}
        </div>
        <div class="uk-text-right">
            <i class="material-icons">person</i>
            Modifiée par :
            {{ requete.personnel }}
        </div>
        <div class="uk-text-right">
            <i class="material-icons">&#xE916;</i>
            Date modification :{{ requete.updatedAt|date('d-m-Y') }}
        </div>
        <div class="uk-text-right">
            <i class="material-icons">person</i>
            Modifiée par :
            {{ requete.personnel }}
        </div>

    </div>
    <div id="page_content_inner">
        <script src="http://cdn.ckeditor.com/4.6.2/standard-all/ckeditor.js"></script>

        <div class="uk-grid">
            <div class="uk-width-2-10">
                <div class="md-card">
                    <ul class="md-list">
                        <li>
                            <div class="md-list-content" style="text-align: center">
                                <span class="uk-text-small uk-text-muted uk-display-block">Nature de requête  </span>
                                <span class="md-list-heading uk-text-large">{{ requete.natureRequete }}</span>
                            </div>
                        </li>
                        <li>
                            <div class="md-list-content" style="text-align: center">
                                <span class="uk-text-small uk-text-muted uk-display-block">Types de bien  </span>
                            </div>
                            <div class="uk-margin-bottom uk-text-center uk-position-relative">
                                {% if  requete.typeBiens|length == 0 %}
                                    <span class="uk-badge uk-badge-danger">  pas de types de bien </span>
                                {% endif %}
                                {% for typeBien in  requete.typeBiens %}
                                    <span class="uk-badge uk-badge-success">{{ typeBien }}</span>
                                {% endfor %}
                            </div>
                        </li>


                    </ul>
                </div>
                <div class="md-card">
                    <div class="md-card-toolbar">
                        <h3 class="md-card-toolbar-heading-text">
                            Budget
                        </h3>
                    </div>
                    <div class="md-card-content">
                        <ul class="md-list">
                            <li>
                                <div class="md-list-content">
                                    <span class="uk-text-small uk-text-muted uk-display-block">Budget minimal</span>
                                    <span class="md-list-heading uk-text-large"> {{ requete.budgetMin }}</span>
                                </div>
                            </li>
                            <li>
                                <div class="md-list-content">
                                    <span class="uk-text-small uk-text-muted uk-display-block">Budget maximal</span>
                                    <span class="md-list-heading uk-text-large"> {{ requete.budgetMax }}</span>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="md-card">
                    <div class="md-card-toolbar">
                        <h3 class="md-card-toolbar-heading-text" style="text-align: center">
                            Zones
                        </h3>
                    </div>
                    <div class="md-card-content">
                        <div class="md-list-content">
                            <div class="uk-margin-bottom uk-text-center uk-position-relative">
                                {% if  requete.gouvernorats|length == 0 or requete.villes|length == 0 %}
                                    <span class="uk-badge uk-badge-danger"> Pas de zones </span>
                                {% endif %}
                                {% for ville in requete.villes %}
                                    <div class="parsley-row">
                                        <span class="uk-badge uk-badge-success">{{ ville }}</span>
                                    </div>
                                {% endfor %}
                                {#{% for ville in requete.villes %}#}
                                {#<div class="parsley-row">#}
                                {#<span class="uk-badge uk-badge-success">{{ ville }}</span>#}
                                {#</div>#}
                                {#{% endfor %}#}
                            </div>
                        </div>
                    </div>
                </div>


            </div>
            <div class="uk-width-8-10">
                <ul class="uk-tab uk-tab-grid" data-uk-tab="{connect:'#tabs', animation:'slide-horizontal'}">
                    <li><a href="#">Général</a></li>
                    <li><a href="#">Activités</a></li>
                    <li><a href="#">Propositions</a></li>
                    {#<li><a href="#">Rendez-vous</a></li>#}
                </ul>
                <ul id="tabs" class="uk-switcher uk-margin">
                    <li>
                        <div class="uk-grid uk-grid-medium" data-uk-grid-margin>

                            <div class="uk-width-xLarge-10-10  uk-width-large-10-10">
                                <div class="md-card">
                                    <div class="md-card-toolbar">
                                        <h3 class="md-card-toolbar-heading-text">
                                            Détails
                                        </h3>

                                    </div>

                                    <div class="md-card-content large-padding">
                                        <div class="uk-grid uk-grid-divider uk-grid-medium" data-uk-grid-margin>
                                            <div class="uk-width-large-1-2">
                                                <ul class="md-list">
                                                    <li>
                                                        <div class="md-list-content">
                                                            <span class="uk-text-small uk-text-muted uk-display-block">Meublé  </span>
                                                            {#<span class="md-list-heading uk-text-large">#}

                                                            <i class="material-icons">error_outline</i>
                                                            {#</span>#}
                                                        </div>
                                                    </li>
                                                    <li>
                                                        <div class="md-list-content">
                                                            <span class="uk-text-small uk-text-muted uk-display-block"> Chambres  </span>
                                                            <span class="md-list-heading uk-text-large">{{ requete.bedroom }}</span>
                                                        </div>
                                                    </li>
                                                    <li>
                                                        <div class="md-list-content">
                                                            <span class="uk-text-small uk-text-muted uk-display-block">   Salle(s) de bain  </span>
                                                            <span class="md-list-heading uk-text-large">{{ requete.bathroom }}</span>
                                                        </div>
                                                    </li>
                                                </ul>
                                            </div>
                                            <div class="uk-width-large-1-2">
                                                <div class="uk-grid">
                                                    <div class="uk-width-1-2">
                                                        <ul class="md-list">
                                                            <li>
                                                                <div class="md-list-content">
                                                                    <span class="uk-text-small uk-text-muted uk-display-block">&nbsp;Superficie terrain  minimale  </span>
                                                                    {#<span class="md-list-heading uk-text-large">#}
                                                                    <span class="md-list-heading uk-text-large"> {{ requete.totalAreaMin }}</span>

                                                                    {#</span>#}
                                                                </div>
                                                            </li>
                                                            <li>
                                                                <div class="md-list-content">
                                                                    <span class="uk-text-small uk-text-muted uk-display-block">Superficie couverte minimale  </span>
                                                                    {#<span class="md-list-heading uk-text-large">#}

                                                                    <span class="md-list-heading uk-text-large">{{ requete.coveredAreaMin }}</span>
                                                                    {#</span>#}
                                                                </div>
                                                            </li>

                                                        </ul>

                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="uk-grid uk-grid-medium" data-uk-grid-margin>

                                    <div class="uk-width-large-1-3">
                                        <div class="md-card">
                                            <div class="md-card-toolbar">
                                                <h3 class="md-card-toolbar-heading-text">
                                                    Commodités
                                                </h3>
                                            </div>
                                            <div class="md-card-content">
                                                <div class="uk-margin-bottom uk-text-center uk-position-relative">
                                                    {% if  requete.commodites|length == 0 %}
                                                        <span class="uk-badge uk-badge-danger"> Pas de commodités </span>
                                                    {% endif %}
                                                    {% for commodite in  requete.commodites %}
                                                        <div class="parsley-row">
                                                            <span class="uk-badge uk-badge-success">{{ commodite }}</span>
                                                        </div>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="uk-width-large-1-3">
                                        <div class="md-card">
                                            <div class="md-card-toolbar">
                                                <h3 class="md-card-toolbar-heading-text">
                                                    Origines
                                                </h3>
                                            </div>
                                            <div class="md-card-content">
                                                <div class="uk-margin-bottom uk-text-center uk-position-relative">
                                                    {% if  requete.origines|length == 0 %}
                                                        <span class="uk-badge uk-badge-danger">   Pas d'origines </span>
                                                    {% endif %}
                                                    {% for origine in  requete.origines %}
                                                        <div class="parsley-row">
                                                            <span class="uk-badge uk-badge-success">{{ origine }}</span>
                                                        </div>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="uk-width-large-1-3">
                                        <div class="md-card">
                                            <div class="md-card-toolbar">
                                                <h3 class="md-card-toolbar-heading-text">
                                                    Equipements
                                                </h3>
                                            </div>
                                            <div class="md-card-content">
                                                <div class="uk-margin-bottom uk-text-center uk-position-relative">
                                                    {% if  requete.equipements|length == 0 %}
                                                        <span class="uk-badge uk-badge-danger">  Pas d'equipements </span>
                                                    {% endif %}
                                                    {% for equipement in  requete.equipements %}
                                                        <div class="parsley-row">
                                                            <span class="uk-badge uk-badge-success">{{ equipement }}</span>
                                                        </div>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="md-card">
                                    <div class="md-card-toolbar">
                                        <h3 class="md-card-toolbar-heading-text">
                                            Commentaires
                                        </h3>
                                    </div>
                                    <div class="md-card-content large-padding">
                                        <div class="uk-grid uk-grid-divider uk-grid-medium" data-uk-grid-margin>
                                            <div class="uk-width-large-2-2">
                                                <div class="uk-form-row">
                                                    <div class="parsley-row">
                                                        {% if  requete.description|length ==0 %}
                                                            <div class="uk-margin-bottom uk-text-center uk-position-relative">
                                                                <span class="uk-badge uk-badge-danger">  Pas encore de commentaires </span>
                                                            </div>
                                                        {% else %}
                                                            {% autoescape %}
                                                                {{ requete.description|raw }} {# var won't be escaped #}
                                                            {% endautoescape %}
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>

                    <li>
                        <div class="md-card">
                            <div class="md-card-toolbar">
                                <h3 class="md-card-toolbar-heading-text">
                                    Activités
                                </h3>
                            </div>
                            <div class="md-card-content large-padding">
                                <div class="md-card-content">
                                    {% if  requete.taches|length ==0 %}
                                        <div class="uk-margin-bottom uk-text-center uk-position-relative">
                                            <span class="uk-badge uk-badge-danger"> Pas encore d'activités </span>
                                        </div>
                                    {% else %}
                                        <table id="tachestable" class="uk-table uk-table-hover" cellspacing="0"
                                               width="100%">
                                            <thead>
                                            <tr>
                                                <th>Date de creation</th>
                                            <th>Heure</th>
                                                <th>Responsable</th>
                                                <th>Mode</th>
                                                <th>Statut</th>

                                                <th>Déscription</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            {% for tache in requete.taches %}
                                                <tr>
                                                    {#<td>#}
                                                        {#<a title="{{ tache.typeTache.title }}" href=""#}
                                                           {#data-uk-modal="{target:'#modal-afficherTache'}"#}
                                                           {#onclick="UIkit.modal.alert( '{{ tache.description|e('js') }}') ;"#}
                                                           {#data-uk-tooltip="{cls:'uk-tooltip-small',pos:'left'}">#}
                                                            {#<i class="md-icon md-list-addon-icon material-icons uk-text-{{ tache.typeTache.class }}">#}
                                                                {#{{ tache.typeTache.icon|raw }}</i>#}
                                                            {#{{ tache.typeTache }}#}
                                                        {#</a>#}
                                                    {#</td>#}
                                                    <td>  {{ tache.creationDate|date('d/m/Y') }}</td>
                                                    <td>{{ tache.creationDate|date('H:m') }}</td>
                                                    <td>
                                                        <a href="{{ path('personnel_show', { 'id': tache.personnel.id }) }}">  {{ tache.personnel }} </a>
                                                    </td>
                                                    <td>
                                                      {{ tache.typeTache.category }}
                                                    </td>
                                                    <td><i class="md-icon md-list-addon-icon material-icons uk-text-{{ tache.typeTache.class }}">
                                                            {{ tache.typeTache.icon|raw }}</i>
                                                        {{ tache.typeTache }}</td>
                                                    <td>{{ tache.description|raw }}</td>
                                                </tr>
                                            {% endfor %}
                                            {#{% for meeting in requete.meetings %}#}
                                                {#<tr>#}
                                                    {#<td>#}
                                                        {#<a title="{{ meeting.title }}" href=""#}
                                                           {#data-uk-modal="{target:'#modal-afficherTache'}"#}
                                                           {#onclick="UIkit.modal.alert( '{{ meeting.description|e('js') }}') ;"#}
                                                           {#data-uk-tooltip="{cls:'uk-tooltip-small',pos:'left'}">#}
                                                            {#<i class="md-icon md-list-addon-icon material-icons uk-text-{{ tache.typeTache.class }}">#}
                                                                {#{{ tache.typeTache.icon|raw }}</i>#}
                                                            {#{{ meeting.typeTache }}#}
                                                        {#</a>#}
                                                    {#</td>#}
                                                    {#<td>  {{ tache.creationDate|date('d/m/Y H:m') }}</td>#}
                                                    {#<td>#}
                                                        {#<a href="{{ path('personnel_show', { 'id': tache.personnel.id }) }}">  {{ tache.personnel }} </a>#}
                                                    {#</td>#}
                                                {#</tr>#}
                                            {#{% endfor %}#}
                                            </tbody>
                                        </table>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="md-card">
                            <div class="md-card-toolbar">
                                <h3 class="md-card-toolbar-heading-text">
                                    Propositions
                                </h3>
                            </div>
                            <div class="md-card-content large-padding">
                                {% if  requete.proposals|length ==0 %}
                                    <div class="uk-margin-bottom uk-text-center uk-position-relative">
                                        <span class="uk-badge uk-badge-danger">  pas encore de propositions </span>
                                    </div>
                                {% else %}
                                    <table id="propositionstable" class="uk-table uk-table-hover" cellspacing="0"
                                           width="100%">
                                        <thead>
                                        <tr>
                                            <th>Date de création</th>
                                            <th>Heure</th>
                                            <th>Statut</th>
                                            <th>Proposé par</th>
                                            <th>Proposé pour</th>
                                            <th>Déscription</th>
                                            <th>Propriété proposé</th>

                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for proposal in requete.proposals %}
                                            <tr>
                                                <td>  {{ proposal.creationDate|date('d/m/Y') }}</td>
                                                <td>  {{ proposal.creationDate|date('H:m') }}</td>
                                               <td>
                                                   {% if proposal.accepted %}
                                                   Acceptée
                                                   {% else %}
                                                   Réfusée par le client
                                                   {% endif %}
                                               </td>
                                                <td>
                                                    <a href="{{ path('personnel_show', { 'id': proposal.proposedBy.id }) }}">
                                                        {{ proposal.proposedBy }}
                                                    </a>
                                                </td>
                                                <td>
                                                    <a href="{{ path('client_show', { 'code': proposal.proposedFor.code }) }}">
                                                        {{ proposal.proposedFor }}
                                                    </a>
                                                </td>
                                                <td>
                                                  jhg  {#{{ proposal.description|raw }}#}
                                                </td>
                                                <td><a href="{{ path('bien_show', {'id' : proposal.mandat.acquisition.bien.id}) }}">
                                                        {{ proposal.mandat.acquisition.bien.title }}
                                                    </a> </td>

                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                {% endif %}
                            </div>
                        </div>
                    </li>
                    {#<li>#}
                        {#<div class="md-card">#}
                            {#<div class="md-card-toolbar">#}
                                {#<h3 class="md-card-toolbar-heading-text">#}
                                    {#Rendez-vous#}
                                {#</h3>#}
                            {#</div>#}
                            {#<div class="md-card-content large-padding">#}
                                {#{% if  requete.meetings|length == 0 %}#}
                                    {#<div class="uk-margin-bottom uk-text-center uk-position-relative">#}
                                {#<span class="uk-badge uk-badge-danger">#}
                                    {#Pas encore de rendez-vous#}
                                {#</span>#}
                                    {#</div>#}
                                {#{% else %}#}
                                    {#<div class="md-card-content">#}
                                        {#<table id="tableTaches" class="uk-table uk-table-hover" cellspacing="0"#}
                                               {#width="100%">#}
                                            {#<thead>#}
                                            {#<tr>#}
                                                {#<th>Titre</th>#}
                                                {#<th>Date début</th>#}
                                                {#<th>Date fin</th>#}
                                                {#<th>Rendez-vous pour</th>#}
                                            {#</tr>#}
                                            {#</thead>#}
                                            {#<tbody>#}
                                            {#{% for meeting in requete.meetings %}#}
                                                {#<tr>#}
                                                    {#<td>#}
                                                        {#<a data-uk-modal="{target:'#modal-afficherRemind'}"#}
                                                           {#data-uk-tooltip="{cls:'uk-tooltip-small',pos:'left'}"#}
                                                           {#onclick="openMeetingModal('{{ meeting.title }}',#}
                                                                   {#'{{ meeting.beginDate|date('m/m/Y H:m') }}',#}
                                                                   {#'{{ meeting.finishDate|date('m/m/Y H:m') }}',#}
                                                                   {#'{{ meeting.remindFors|join(' - ') }}', '{{ meeting.createdBy }}')">#}
                                                            {#{{ meeting.title }}#}
                                                        {#</a>#}
                                                    {#</td>#}
                                                    {#<td>  {{ meeting.beginDate|date('d/m/Y H:m') }}</td>#}
                                                    {#<td>  {{ meeting.finishDate|date('d/m/Y H:m') }}</td>#}
                                                    {#<td>#}
                                                        {#{% for remindFor in meeting.remindFors %}#}
                                                            {#<a href="{{ path('personnel_show',#}
                                                            {#{ 'id': remindFor.id }) }}">#}
                                                                {#{{ remindFor }} {% if not loop.last %} - {% endif %}#}
                                                            {#</a>#}
                                                        {#{% endfor %}#}
                                                    {#</td>#}
                                                {#</tr>#}
                                            {#{% endfor %}#}
                                            {#</tbody>#}
                                        {#</table>#}
                                    {#</div>#}
                                {#{% endif %}#}
                            {#</div>#}
                        {#</div>#}
                    {#</li>#}
                </ul>
            </div>
        </div>

    </div>
    <div class="md-fab-wrapper md-fab-speed-dial">
        <a class="md-fab md-fab-primary" href="javascript:void(0)" data-uk-tooltip="{pos:'right'}"
           title="Actions">
            <i class="material-icons">&#xE55D;</i></a>
        <div class="md-fab-wrapper-small">
            {% for typeTache in typesTaches %}
                <a title="{{ typeTache.title }}" data-uk-tooltip="{cls:'uk-tooltip-small',pos:'left'}"
                   class="md-fab md-fab-small md-fab-{{ typeTache.class }}" href=""
                   data-uk-modal="{target:'#modal-ajouterTache'}"
                   onclick="openTacheModal('{{ typeTache.title }}', '{{ typeTache.id }}', '{{ requete.reference }}', '{{ requete.id }}','{{ typeTache.showCalendar }}' )">
                    <i class="material-icons">{{ typeTache.icon|raw }}</i>
                </a>
            {% endfor %}
            <a class="md-fab md-fab-small md-fab-warning" href=""
               data-uk-modal=" { target:'#modal-ajouterP' } "
               onclick="openProposalModal()"
               data-uk-tooltip="{cls:'uk-tooltip-small',pos:'left'}" title="Ajouter proposition">
                <i class="material-icons">&#xE42E;</i>
            </a>
            <a class="md-fab md-fab-small md-fab-danger" href="javascript:void(0)"
               data-uk-tooltip="{cls:'uk-tooltip-small',pos:'left'}" title="Supprimer"
               onclick="confirmDelete({{ requete.id }})">
                <i class="material-icons">&#xE92B;</i>
            </a>
            <a class="md-fab md-fab-small md-fab-success" href="{{ path('requete_edit', {'id': requete.id}) }}"
               data-uk-tooltip="{cls:'uk-tooltip-small',pos:'left'}" title="Modifier">
                <i class="material-icons">&#xE3C9;</i>
            </a>
        </div>
    </div>
{% endblock %}
{% block js %}
    {{ parent() }}
    <script>
        function openTacheModal(typeTacheTitle, typeTacheId, requeteReference, requeteId , showCalendar) {

            var modal = ' <div class=uk-modal-header><h2>Ajouter une tâche</h2></div>' +
                '<form method=POST name=form_tacheNouvelle action=# class=uk-form-stacked form_validation>' +
                '<div class=uk-grid data-uk-grid-margin>' +
                ' <div class=uk-width-medium-1-2>' +
                ' <div class=parsley-row>' +
                ' <div class=uk-input-group>' +
                ' <span class=uk-form-help-block>Type de Tache</span>' +
                ' <input id=typeTache class=md-input type=text value="' + typeTacheTitle + '" readonly/>' +
                ' <input id=typeTacheValue name=typeTachee type=hidden value="' + typeTacheId + '" />' +
                ' </div>' +
                ' </div>' +
                '  </div>' +
                ' <div class=uk-width-medium-1-2>' +
                '  <div class=parsley-row>' +
                ' <div class=uk-input-group>' +
                ' <span class=uk-form-help-block >Requête</span>' +
                ' <input id=requete class=md-input type=text value="' + requeteReference + '" readonly />' +
                ' <input id=requeteValue name=requetee type=hidden value="' + requeteId + '" />' +
                ' </div>' +
                ' </div>' +
                ' </div>' +
                ' </div>' ;
                 if (showCalendar)
                 {
                     modal+= '<div class=uk-grid data-uk-grid-margin>' +
                         ' <div class=uk-width-medium-1-2>' +
                         '  <div class=parsley-row>' +
                         ' <div class=uk-input-group id="Day">' +
                         ' <span class=uk-form-help-block >Jour</span>' +
                         '<input class="md-input" type="text" id="uk_dp_1" data-uk-datepicker="{format:\'DD.MM.YYYY\'}">' +
                         ' </div>' +
                         ' </div>' +
                         ' </div>' +
                         ' <div class=uk-width-medium-1-2>' +
                         '  <div class=parsley-row>' +
                         ' <div class=uk-input-group id="Times">' +
                         ' <span class=uk-form-help-block >Heure</span>' +
                         '<input class="md-input" type="text" id="uk_tp_1" data-uk-timepicker>' +
                         '<input class="md-input" type="text" id="uk_tp_1" data-uk-timepicker>' +
                         ' </div>' +
                         ' </div>' +
                         ' </div>' +
                         ' </div>' ;
                 }

                modal+= '  <div class=uk-grid data-uk-grid-margin>' +
                '  <div class=uk-width-medium-2-2>' +
                '  <div class=parsley-row>' +
                '  <div class=uk-input-group>' +
                ' <span class=uk-form-help-block>Commentaires</span>' +
                '  <textarea id=descriptionn name=description></textarea>' +
                ' </div>' +
                ' </div>' +
                '  </div>' +
                ' </div>' +
                '  <div class=uk-grid data-uk-grid-margin>' +
                ' <div class=uk-width-medium-2-2>' +
                '<div class="uk-margin-bottom uk-text-center uk-position-relative">' +
                ' <a class="md-btn md-btn-primary" href="#"  title="Ajouter un rappel"  ' +
                'data-uk-modal=" { target:\'#modal-ajouterT\' } " ' +
                ' onclick=" openRemindModal()"><i class=\'material-icons\'>&#xE856;</i>Ajouter un rappel</a>' +
                ' <a class="md-btn md-btn-primary" href="#" title="Ajouter une proposition" ' +
                'data-uk-modal=" { target:\'#modal-ajouterP\' } " ' +
                ' onclick=" openProposalModal()"><i class=\'material-icons\'>&#xE42E;</i>Ajouter une proposition</a>' +
                ' </div>' +
                ' </div>' +
                ' </div>' +
                ' </form>';
            UIkit.modal.confirm(modal, function () {
                    ajouterTache(typeTacheId, requeteId);
                }
            );
            CKEDITOR.replace(descriptionn, {height: 150});
        }
        function openMeetingModal(title, start, end, remindFor, createdBy) {
            UIkit.modal.alert('' +
                '<h3 class="heading_b uk-margin-medium-bottom">' +
                'Informations sur le rendez-vous</h3><div class="uk-margin-medium-bottom" id="calendar_colors">' +
                '</div>' +
                '<ul class="md-list">' +
                '<li>' +
                '<div class="md-list-content">' +
                '<span class="uk-text-small uk-text-muted uk-display-block">Titre  </span>' +
                '<span class="md-list-heading uk-text-large">' + title +
                '</span>' +
                '</div>' +
                '</li>' +
                '<li>' +
                '<div class="md-list-content">' +
                '<span class="uk-text-small uk-text-muted uk-display-block">Débute le  </span>' +
                '<span class="md-list-heading uk-text-large">' + start +
                '</span>' +
                '</div>' +
                '</li>' +
                '<li>' +
                '<div class="md-list-content">' +
                '<span class="uk-text-small uk-text-muted uk-display-block">Se términe le  </span>' +
                '<span class="md-list-heading uk-text-large">' + end +
                '</span>' +
                '</div>' +
                '</li>' +
                '<li>' +
                '<div class="md-list-content">' +
                '<span class="uk-text-small uk-text-muted uk-display-block">Rendez-vous pour</span>' +
                '<span class="md-list-heading uk-text-large">' + remindFor +
                '</span>' +
                '</div>' +
                '</li>' +
                '<li>' +
                '<div class="md-list-content">' +
                '<span class="uk-text-small uk-text-muted uk-display-block">Rendez-vous créé par</span>' +
                '<span class="md-list-heading uk-text-large">' + createdBy +
                '</span>' +
                '</div>' +
                '</li>' +
                '</ul>' +
                '', {
                labels: {
                    Ok: 'Fermer'
                }
            });
        }
        function openRemindModal() {
            var calendarColorsWrapper = $('<div id="calendar_colors_wrapper"></div>');
            var calendarColorPicker = altair_helpers.color_picker(calendarColorsWrapper).prop('outerHTML');
            UIkit.modal.confirm(
                '<h3 class="heading_b uk-margin-medium-bottom">Ajouter un rappel</h3>' +
                '<div class="uk-margin-medium-bottom" id="calendar_colors">' +
                ' <span class="uk-form-help-block">Couleur</span>' + calendarColorPicker +
                '</div>' +
                '<form method="POST" name="form_adresse" action="#" class="uk-form-stacked" id="form_validation">' +
                '<div class="uk-grid uk-grid-divider uk-grid-medium" data-uk-grid-margin>' +
                '<div class="uk-width-large-2-2">' +
                '<div class="uk-form-row">' +
                '<div class="parsley-row">' +
                '<span class="uk-form-help-block">Personnel</span>' +
                '<input id="personnel" class="md-input" value="{{ app.user.personnel.name }}" name="personnel" type="text" readonly />' +
                '<input id="personnelId" class="md-input" name="personnelId" value="{{ app.user.personnel.id }}" type="hidden"  required />' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '<div class="uk-grid uk-grid-divider uk-grid-medium" data-uk-grid-margin>' +
                '<div class="uk-width-large-1-2">' +
                '<div class="uk-form-row">' +
                '<div class="parsley-row">' +
                '<span class="uk-form-help-block">Requête</span>' +
                '<input id="requete" class="md-input uk-form-width-small" name="requete" value="{{ requete.reference }}" type="text" readonly />' +
                '<input id="requeteID" class="md-input" name="requeteID" value="{{ requete.id }}" type="hidden"  required />' +
                '</div>' +
                '</div>' +
                '</div>' +
                '<div class="uk-width-large-1-2">' +
                '<div class="uk-form-row">' +
                '<div class="parsley-row" style=" width: 150px;">' +
                '<span class="uk-form-help-block">Titre</span>' +
                '<input id="title" class="md-input" name="title" type="text" value="" required />' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '<div class="uk-grid uk-grid-divider uk-grid-large" data-uk-grid-margin>' +
                '<div class="uk-width-large-1-2">' +
                '<div class="uk-form-row">' +
                '<div class="parsley-row" ">' +
                '<span class="uk-form-help-block">Date début</span>' +
                '<input id="datestart" name="datestart" data-uk-datepicker = "{format:\'DD-MM-YYYY\'}" class = "md-input uk-form-width-small"  required />' +
                '</div>' +
                '</div>' +
                '</div>' +
                '<div class="uk-width-large-1-2">' +
                '<div class="uk-form-row">' +
                '<div class="parsley-row">' +
                '<span class="uk-form-help-block">Heure début</span>' +
                '<input id="timestart" name="timestart" required data-uk-timepicker="{start:8, end:19}" class="md-input uk-form-width-small"/>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '<div class="uk-grid uk-grid-divider uk-grid-large" data-uk-grid-margin>' +
                '<div class="uk-width-large-1-2">' +
                '<div class="uk-form-row">' +
                '<div class="parsley-row" >' +
                '<span class="uk-form-help-block">Date fin</span>' +
                '<input id="dateend" name="dateend"  data-uk-datepicker = "{format:\'DD-MM-YYYY\'}", class = "md-input uk-form-width-small"  required />' +
                '</div>' +
                '</div>' +
                '</div>' +
                '<div class="uk-width-large-1-2">' +
                '<div class="uk-form-row">' +
                '<div class="parsley-row">' +
                '<span class="uk-form-help-block">Heure fin</span>' +
                '<input id="timeend"  name="timeend"  required data-uk-timepicker="{start:8, end:19}" class="md-input uk-form-width-small"/>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</form>' +
                ''
                , function () {
                    var title = $("#title");
                    if (title.val() !== '') {
                        var eventColor = $('#calendar_colors_wrapper').find('input').val();
                        var url = '{{ path('remindrequete_add') }}';
                        $.ajax({
                            url: url,
                            type: 'POST',
                            data: 'title=' + title.val() + '&start=' + $('#datestart').val() + " " + $('#timestart').val()
                            + '&end=' + $('#dateend').val() + " " + $('#timeend').val() + '&color=' + eventColor
                            + '&requete=' + $('#requeteID').val() + '&remindFor=' + $('#personnelId').val(),

                            success: function () {
                                UIkit.modal.alert('Le rappel a été ajouté avec succès.')
                            },
                            error: function () {
                                UIkit.modal.alert('Erreur')
                            }
                        });
                    }
                }, {
                    labels: {
                        Ok: 'Ajouter',
                        Cancel: 'Fermer'
                    }
                });
        }
        function openProposalModal() {
            UIkit.modal.confirm(
                '<h3 class="heading_b uk-margin-medium-bottom">Ajouter une proposition</h3>' +
                '<form method="POST" name="form_proposal" action="#" class="uk-form-stacked" id="form_validation">' +
                '<div class="uk-grid uk-grid-divider uk-grid-medium" data-uk-grid-margin>' +
                '<div class="uk-width-large-2-2">' +
                '<div class="uk-form-row">' +
                '<div class="parsley-row">' +
                '<span class="uk-form-help-block">Requête</span>' +
                '<input id="requete" class="md-input" value="{{ requete.reference }}" name="acquisition" type="text" readonly />' +
                '<input id="requeteID" class="md-input" name="requeteID" value="{{ requete.id }}" type="hidden"  required />' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '<div class="uk-grid uk-grid-divider uk-grid-medium" data-uk-grid-margin>' +
                '<div class="uk-width-large-1-2">' +
                '<div class="uk-form-row">' +
                '<div class="parsley-row">' +
                '<span class="uk-form-help-block">Mandat</span>' +
                '<select id="mandats" > </select>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '<div class="uk-width-large-1-2">' +
                '<div class="uk-form-row">' +
                '<div class="parsley-row">' +
                '<span class="uk-form-help-block">Client</span>' +
                '<select id="clients" > </select>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</form>' +
                ''
                , function () {
                    var clients = $("#clients");
                    var mandats = $("#mandats");
                    if (clients.val() !== '' && mandats.val() !== '') {
                        var url = '{{ path('proposal_add') }}';
                        $.ajax({
                            url: url,
                            type: 'POST',
                            data: 'client=' + clients.val() + '&requete=' + $('#requeteID').val() + '&mandat=' + mandats.val(),
                            success: function () {
                                UIkit.modal.alert('La proposition a été ajoutée avec succès.', {
                                    labels: {
                                        Ok: 'Fermer'
                                    }
                                }).on('hide.uk.modal', function () {
                                    location.reload(true);
                                });
                            },
                            error: function () {
                                UIkit.modal.alert('Erreur', {
                                    labels: {
                                        Ok: 'Fermer'
                                    }
                                });
                            }
                        });
                    }
                }
                , {
                    labels: {
                        Ok: 'Ajouter',
                        Cancel: 'Fermer'
                    }
                });
            var clients = $('#clients');
            clients.selectize({
                placeholder: 'Choisir un client....             ',
                hideSelected: true
            });
            getClients(clients);
            var mandats = $('#mandats');
            mandats.selectize({
                placeholder: 'Choisir un mandat....             ',
                hideSelected: true
            });
            getMandats(mandats);
        }
        function getClients(select) {
            var clients = select[0].selectize;
            clients.clearOptions();
            var url = '{{ path('client_list') }}';
            $.ajax({
                url: url,
                type: 'POST',
                success: function (data) {
                    if (data !== null) {
                        $.each(data, function (key, element) {
                            clients.addOption({
                                text: element.text,
                                value: element.value
                            });
                        });
                    }
                    else {
                        UIkit.modal.alert('Rien', {
                            labels: {
                                Ok: 'Fermer'
                            }
                        });
                    }
                },
                error: function () {
                    UIkit.modal.alert('Erreur', {
                        labels: {
                            Ok: 'Fermer'
                        }
                    });
                }
            });
        }
        function getMandats(select) {
            var mandats = select[0].selectize;
            mandats.clearOptions();
            var url = '{{ path('mandat_list') }}';
            $.ajax({
                url: url,
                type: 'POST',
                success: function (data) {
                    if (data !== null) {
                        $.each(data, function (key, element) {
                            mandats.addOption({
                                text: element.title,
                                value: element.id
                            });
                        });
                    }
                    else {
                        UIkit.modal.alert('Rien', {
                            labels: {
                                Ok: 'Fermer'
                            }
                        });
                    }
                },
                error: function () {
                    UIkit.modal.alert('Erreur', {
                        labels: {
                            Ok: 'Fermer'
                        }
                    });
                }
            });
        }
        function ajouterTache($typeTache, $requete) {
            var day = $('#Day').find('input').val();
            var begin = $('#uk_tp_1');
            var end = begin.closest('div').next('div').find('input').val();




            var description = CKEDITOR.instances['descriptionn'].getData();


            var url = '{{ path('tache_requete_new') }}';
            var data = {
                'typetache': $typeTache,
                'requete': $requete,
                'description': description,
                'day':day,
                'begin':begin.val(),
                'end':end,
            };
            $.ajax({
                async: true,
                type: "POST",
                url: url,
                dataType: 'json',
                data: data,
                success: function (json) {
                    console.log(json)
                    if (json.success === false || json.message !== '') {
                        UIkit.modal.alert('erreur');

                    } else {
                        UIkit.modal.alert('La tâche a été ajoutée avec succès.'
                        ).on('hide.uk.modal', function () {
                            location.reload(true);
                        });

                    }
                },
                error: function () {
                    UIkit.modal.alert('exception contacter SBC');
                }
            });
        }

        function confirmDelete(id) {
            UIkit.modal.confirm('Voulez vous vraiment supprimer cette requête ?',
                function () {
                    deleteIt(id);
                },
                {
                    labels: {
                        Ok: 'Oui',
                        Cancel: 'Non'
                    }
                });
        }
        function deleteIt(id) {
            var url = '{{ path('requete_delete', {'id': 'iD'}) }}';
            url = url.replace('iD', id);
            $.ajax({
                url: url,
                type: 'DELETE',
                success: function (json) {
                    if (json.success) {
                        UIkit.modal.alert('La requête a été supprimée avec succès.',
                            {
                                labels: {
                                    Ok: 'Fermer'
                                }
                            }
                        ).on('hide.uk.modal', function () {
                            history.back();
                        });
                    }
                    else {
                        UIkit.modal.alert('Vous n\'avez pas le droit de supprimer cette requête pour des raisons de sécurité',
                            {
                                labels: {
                                    Ok: 'Fermer'
                                }
                            });
                    }
                },
                error: function () {
                    UIkit.modal.alert('Vous n\'avez pas le droit de supprimer cette requête pour des raisons de sécurité',
                        {
                            labels: {
                                Ok: 'Fermer'
                            }
                        });
                }
            });
        }
    </script>
{% endblock %}